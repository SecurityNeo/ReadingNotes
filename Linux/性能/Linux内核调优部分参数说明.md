# Linux内核调优部分参数说明 #

[http://www.ttlsa.com/linux/linux-kernel-tuning-section-parameter-description/](http://www.ttlsa.com/linux/linux-kernel-tuning-section-parameter-description/)

- net.core.rmem_default = 262144

	接收套接字缓冲区大小的默认值(以字节为单位)。

- net.core.rmem_max = 16777216

	接收套接字缓冲区大小的最大值(以字节为单位)。

- net.core.wmem_default = 262144

	发送套接字缓冲区大小的默认值(以字节为单位)。

- net.core.wmem_max = 16777216

	发送套接字缓冲区大小的最大值(以字节为单位)。

- net.core.somaxconn = 262144

	用来限制监听(LISTEN)队列最大数据包的数量，超过这个数量就会导致链接超时或者触发重传机制。

- net.core.netdev_max_backlog = 262144

	netdev_max_backlog是内核从NIC收包后，交由协议栈（如IP、TCP）处理之前的缓冲队列。每个CPU核都有一个backlog队列，与Ring Buffer同理，当接收包的速率大于内核协议栈处理的速率时，CPU的backlog队列不断增长，当达到设定的netdev_max_backlog值时，数据包将被丢弃。通过 `cat /proc/net/softnet_stat`可以确定是否发生了backlog队列溢出:

	```
	[root@wg-esm-hc-1 ~]# cat /proc/net/softnet_stat
	0002562c 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000851b8 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	0007d457 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000111fb 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000278e5 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000351a9 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	0001fcd4 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00046236 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00001209 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000bb8 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000701 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000eb2 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000016d8 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000d92 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000a80 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000ec3 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00022569 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000523aa 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	0002f95c 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00059baa 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00061fec 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000549bf 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	0009e672 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000a5f80 00000000 00000001 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000005cc 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000b1d 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000a78 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000a63 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	0000079c 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	000007ea 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	00000641 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	0000058e 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	```

	每一行代表每个CPU核的状态统计，从CPU0依次往下； 每一列代表一个CPU核的各项统计：第一列代表中断处理程序收到的包总数；第二列代表由于netdev_max_backlog队列溢出而被丢弃的包总数。

- net.ipv4.tcp_max_orphans = 262144

	表示系统中最多有多少TCP套接字不被关联到任何一个用户文件句柄上。如果超过这里设置的数字，连接就会复位并输出警告信息。这个限制仅仅是为了防止简单的DoS攻击。此值不能太小。

- net.ipv4.tcp_max_syn_backlog = 262144

	表示那些尚未收到客户端确认信息的连接（SYN消息）队列的长度，默认为1024，加大队列长度为262144，可以容纳更多等待连接的网络连接数。
 
- net.ipv4.tcp_max_tw_buckets = 10000

	表示系统同时保持TIME_WAIT套接字的最大数量。如果超过此数，TIME_WAIT套接字会被立刻清除并且打印警告信息。之所以要设定这个限制，纯粹为了抵御那些简单的DoS攻击，不过，过多的TIME_WAIT套接字也会消耗服务器资源，甚至死机。

- net.ipv4.ip_local_port_range = 1024 65500

	表示允许系统打开的端口范围。

- net.ipv4.tcp_tw_recycle = 1
 
	表示开启TCP连接中TIME_WAIT套接字的快速回收，默认为0，表示关闭。

- net.ipv4.tcp_tw_reuse = 1

	表示允许重用TIME_WAIT状态的套接字用于新的TCP连接,默认为0，表示关闭。

- net.ipv4.tcp_syncookies = 1

	当出现SYN等待队列溢出时，启用cookies来处理，可防范少量SYN攻击，默认为0，表示关闭。

- net.ipv4.tcp_synack_retries = 1

	表示系统允许SYN连接的重试次数。为了打开对端的连接，内核需要发送一个SYN并附带一个回应前面一个SYN的ACK包。也就是所谓三次握手中的第二次握手。这个设置决定了内核放弃连接之前发送SYN+ACK包的数量。

- net.ipv4.tcp_syn_retries = 1

	表示在内核放弃建立连接之前发送SYN包的数量。

- net.ipv4.tcp_fin_timeout = 30

	减少处于FIN-WAIT-2连接状态的时间，使系统可以处理更多的连接。

- net.ipv4.tcp_keepalive_time = 600

	这个参数表示当keepalive启用时，TCP发送keepalive消息的频度。默认是2小时，若将其设置得小一些，可以更快地清理无效的连接。

- net.ipv4.tcp_keepalive_intvl = 30

	探测消息未获得响应时，重发该消息的间隔时间（秒）。系统默认75秒。

- net.ipv4.tcp_keepalive_probes = 3
 
	在认定连接失效之前，发送多少个TCP的keepalive探测包。系统默认值是9。这个值乘以tcp_keepalive_intvl之后决定了，一个连接发送了keepalive探测包之后可以有多少时间没有回应。

- net.ipv4.tcp_mem = 786432 1048576 1572864

	确定TCP栈应该如何反映内存使用，每个值的单位都是内存页（通常是4KB）。第一个值是内存使用的下限；第二个值是内存压力模式开始对缓冲区使用应用压力的上限；第三个值是内存使用的上限。在这个层次上可以将报文丢弃，从而减少对内存的使用。示例中第一个值为786432*4/1024/1024=3G，第二个值为1048576*4/1024/1024=4G，第三个值为1572864*4/1024/1024=6G。

- fs.aio-max-nr = 1048576

	此参数限制并发未完成的异步请求数目，应该设置避免I/O子系统故障。

- fs.file-max = 6815744

	该参数决定了系统中所允许的文件句柄最大数目，文件句柄设置代表linux系统中可以打开的文件的数量。

- kernel.sem = 250 32000 100 128

	第一列，表示每个信号集中的最大信号量数目。
	第二列，表示系统范围内的最大信号量总数目。
	第三列，表示每个信号发生时的最大系统操作数目。
	第四列，表示系统范围内的最大信号集总数目。
	
	（第一列）*（第四列）=（第二列）

- vm.swappiness = 0

	表示尽量使用内存，减少使用磁盘swap交换分区，内存速度明显高于磁盘一个数量级。
